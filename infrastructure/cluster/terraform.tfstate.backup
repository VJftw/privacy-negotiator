{
    "version": 3,
    "terraform_version": "0.9.7",
    "serial": 11,
    "lineage": "0d1c014a-e89a-42d8-8788-b15714d121a1",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {
                "subnets": {
                    "sensitive": false,
                    "type": "list",
                    "value": [
                        "subnet-d4b96fb3",
                        "subnet-cc548985",
                        "subnet-cf3c2e97"
                    ]
                }
            },
            "resources": {
                "aws_ecs_cluster.app": {
                    "type": "aws_ecs_cluster",
                    "depends_on": [],
                    "primary": {
                        "id": "arn:aws:ecs:eu-west-1:432797969841:cluster/privacy-negotiator",
                        "attributes": {
                            "id": "arn:aws:ecs:eu-west-1:432797969841:cluster/privacy-negotiator",
                            "name": "privacy-negotiator"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_instance_profile.app": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.app_instance"
                    ],
                    "primary": {
                        "id": "privacy-negotiator.ecs-instprofile",
                        "attributes": {
                            "arn": "arn:aws:iam::432797969841:instance-profile/privacy-negotiator.ecs-instprofile",
                            "id": "privacy-negotiator.ecs-instprofile",
                            "name": "privacy-negotiator.ecs-instprofile",
                            "path": "/",
                            "role": "privacy-negotiator.ecs-instance-role",
                            "roles.#": "1",
                            "roles.1926900766": "privacy-negotiator.ecs-instance-role",
                            "unique_id": "AIPAJPJVY4DQMYM6SU33M"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role.app_instance": {
                    "type": "aws_iam_role",
                    "depends_on": [],
                    "primary": {
                        "id": "privacy-negotiator.ecs-instance-role",
                        "attributes": {
                            "arn": "arn:aws:iam::432797969841:role/privacy-negotiator.ecs-instance-role",
                            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
                            "create_date": "2017-06-07T18:18:12Z",
                            "id": "privacy-negotiator.ecs-instance-role",
                            "name": "privacy-negotiator.ecs-instance-role",
                            "path": "/",
                            "unique_id": "AROAJRX4KBV42WSENSRFW"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role.fleet": {
                    "type": "aws_iam_role",
                    "depends_on": [],
                    "primary": {
                        "id": "privacy-negotiator-fleet",
                        "attributes": {
                            "arn": "arn:aws:iam::432797969841:role/privacy-negotiator-fleet",
                            "assume_role_policy": "{\"Version\":\"2008-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ec2.amazonaws.com\",\"spotfleet.amazonaws.com\"]},\"Action\":\"sts:AssumeRole\"}]}",
                            "create_date": "2017-06-07T18:18:11Z",
                            "id": "privacy-negotiator-fleet",
                            "name": "privacy-negotiator-fleet",
                            "path": "/",
                            "unique_id": "AROAJYFKHMQZEFB6MIV3Y"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role_policy.app_instance": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.app_instance"
                    ],
                    "primary": {
                        "id": "privacy-negotiator.ecs-instance-role:privacy-negotiator.app_policy",
                        "attributes": {
                            "id": "privacy-negotiator.ecs-instance-role:privacy-negotiator.app_policy",
                            "name": "privacy-negotiator.app_policy",
                            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:*\",\n        \"ecs:*\",\n        \"autoscaling:DescribeAutoScalingInstances\",\n        \"ecr:GetAuthorizationToken\",\n        \"ecr:BatchCheckLayerAvailability\",\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:BatchGetImage\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"route53:*\",\n        \"route53domains:*\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n",
                            "role": "privacy-negotiator.ecs-instance-role"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_iam_role_policy.fleet": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.fleet"
                    ],
                    "primary": {
                        "id": "privacy-negotiator-fleet:privacy-negotiator.fleet_policy",
                        "attributes": {
                            "id": "privacy-negotiator-fleet:privacy-negotiator.fleet_policy",
                            "name": "privacy-negotiator.fleet_policy",
                            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [{\n    \"Effect\": \"Allow\",\n    \"Action\": [\n       \"ec2:DescribeImages\",\n       \"ec2:DescribeSubnets\",\n       \"ec2:RequestSpotInstances\",\n       \"ec2:TerminateInstances\",\n       \"ec2:DescribeInstanceStatus\",\n       \"iam:PassRole\"\n        ],\n    \"Resource\": [\"*\"]\n  }]\n}\n",
                            "role": "privacy-negotiator-fleet"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_internet_gateway.app": {
                    "type": "aws_internet_gateway",
                    "depends_on": [
                        "aws_vpc.app"
                    ],
                    "primary": {
                        "id": "igw-6f9de20b",
                        "attributes": {
                            "id": "igw-6f9de20b",
                            "tags.%": "0",
                            "vpc_id": "vpc-46ab7b21"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_route_table.app": {
                    "type": "aws_route_table",
                    "depends_on": [
                        "aws_internet_gateway.app",
                        "aws_vpc.app"
                    ],
                    "primary": {
                        "id": "rtb-c9d6fbae",
                        "attributes": {
                            "id": "rtb-c9d6fbae",
                            "propagating_vgws.#": "0",
                            "route.#": "1",
                            "route.2691952309.cidr_block": "0.0.0.0/0",
                            "route.2691952309.egress_only_gateway_id": "",
                            "route.2691952309.gateway_id": "igw-6f9de20b",
                            "route.2691952309.instance_id": "",
                            "route.2691952309.ipv6_cidr_block": "",
                            "route.2691952309.nat_gateway_id": "",
                            "route.2691952309.network_interface_id": "",
                            "route.2691952309.vpc_peering_connection_id": "",
                            "tags.%": "2",
                            "tags.Name": "privacy-negotiator.ecs",
                            "tags.cluster": "privacy-negotiator",
                            "vpc_id": "vpc-46ab7b21"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_route_table_association.a.0": {
                    "type": "aws_route_table_association",
                    "depends_on": [
                        "aws_route_table.app",
                        "aws_subnet.app.*"
                    ],
                    "primary": {
                        "id": "rtbassoc-9ec5bcf8",
                        "attributes": {
                            "id": "rtbassoc-9ec5bcf8",
                            "route_table_id": "rtb-c9d6fbae",
                            "subnet_id": "subnet-d4b96fb3"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_route_table_association.a.1": {
                    "type": "aws_route_table_association",
                    "depends_on": [
                        "aws_route_table.app",
                        "aws_subnet.app.*"
                    ],
                    "primary": {
                        "id": "rtbassoc-f5c5bc93",
                        "attributes": {
                            "id": "rtbassoc-f5c5bc93",
                            "route_table_id": "rtb-c9d6fbae",
                            "subnet_id": "subnet-cc548985"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_route_table_association.a.2": {
                    "type": "aws_route_table_association",
                    "depends_on": [
                        "aws_route_table.app",
                        "aws_subnet.app.*"
                    ],
                    "primary": {
                        "id": "rtbassoc-9fc5bcf9",
                        "attributes": {
                            "id": "rtbassoc-9fc5bcf9",
                            "route_table_id": "rtb-c9d6fbae",
                            "subnet_id": "subnet-cf3c2e97"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_security_group.instance_sg": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "aws_vpc.app"
                    ],
                    "primary": {
                        "id": "sg-984652e1",
                        "attributes": {
                            "description": "Controls access to nodes in ECS cluster",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.ipv6_cidr_blocks.#": "0",
                            "egress.482069346.prefix_list_ids.#": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-984652e1",
                            "ingress.#": "1",
                            "ingress.1960698028.cidr_blocks.#": "1",
                            "ingress.1960698028.cidr_blocks.0": "10.0.0.0/16",
                            "ingress.1960698028.from_port": "0",
                            "ingress.1960698028.ipv6_cidr_blocks.#": "0",
                            "ingress.1960698028.protocol": "-1",
                            "ingress.1960698028.security_groups.#": "0",
                            "ingress.1960698028.self": "false",
                            "ingress.1960698028.to_port": "0",
                            "name": "privacy-negotiator.ecs-sg",
                            "owner_id": "432797969841",
                            "tags.%": "2",
                            "tags.Name": "privacy-negotiator.ecs.instance",
                            "tags.cluster": "privacy-negotiator",
                            "vpc_id": "vpc-46ab7b21"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_spot_fleet_request.cheap_compute": {
                    "type": "aws_spot_fleet_request",
                    "depends_on": [
                        "aws_iam_instance_profile.app",
                        "aws_iam_role.fleet",
                        "aws_security_group.instance_sg",
                        "aws_subnet.app",
                        "aws_subnet.app.1",
                        "aws_subnet.app.2",
                        "data.template_file.user_data"
                    ],
                    "primary": {
                        "id": "sfr-dc5b8664-5b64-41bd-a9aa-29009db73905",
                        "attributes": {
                            "allocation_strategy": "lowestPrice",
                            "client_token": "terraform-00e0285779aa337ad5fee3f00f",
                            "excess_capacity_termination_policy": "Default",
                            "iam_fleet_role": "arn:aws:iam::432797969841:role/privacy-negotiator-fleet",
                            "id": "sfr-dc5b8664-5b64-41bd-a9aa-29009db73905",
                            "launch_specification.#": "3",
                            "launch_specification.2830029446.ami": "ami-13c8f475",
                            "launch_specification.2830029446.associate_public_ip_address": "false",
                            "launch_specification.2830029446.availability_zone": "eu-west-1c",
                            "launch_specification.2830029446.ebs_block_device.#": "0",
                            "launch_specification.2830029446.ebs_optimized": "false",
                            "launch_specification.2830029446.ephemeral_block_device.#": "0",
                            "launch_specification.2830029446.iam_instance_profile": "privacy-negotiator.ecs-instprofile",
                            "launch_specification.2830029446.instance_type": "m4.large",
                            "launch_specification.2830029446.key_name": "spotfleet",
                            "launch_specification.2830029446.monitoring": "false",
                            "launch_specification.2830029446.placement_group": "",
                            "launch_specification.2830029446.placement_tenancy": "",
                            "launch_specification.2830029446.root_block_device.#": "0",
                            "launch_specification.2830029446.spot_price": "0.03",
                            "launch_specification.2830029446.subnet_id": "subnet-cf3c2e97",
                            "launch_specification.2830029446.user_data": "5303dc2604da2a8f19732006df98143e4da7f2c4",
                            "launch_specification.2830029446.vpc_security_group_ids.#": "1",
                            "launch_specification.2830029446.vpc_security_group_ids.1426649768": "sg-984652e1",
                            "launch_specification.2830029446.weighted_capacity": "",
                            "launch_specification.562947105.ami": "ami-13c8f475",
                            "launch_specification.562947105.associate_public_ip_address": "false",
                            "launch_specification.562947105.availability_zone": "eu-west-1a",
                            "launch_specification.562947105.ebs_block_device.#": "0",
                            "launch_specification.562947105.ebs_optimized": "false",
                            "launch_specification.562947105.ephemeral_block_device.#": "0",
                            "launch_specification.562947105.iam_instance_profile": "privacy-negotiator.ecs-instprofile",
                            "launch_specification.562947105.instance_type": "m4.large",
                            "launch_specification.562947105.key_name": "spotfleet",
                            "launch_specification.562947105.monitoring": "false",
                            "launch_specification.562947105.placement_group": "",
                            "launch_specification.562947105.placement_tenancy": "",
                            "launch_specification.562947105.root_block_device.#": "0",
                            "launch_specification.562947105.spot_price": "0.03",
                            "launch_specification.562947105.subnet_id": "subnet-d4b96fb3",
                            "launch_specification.562947105.user_data": "5303dc2604da2a8f19732006df98143e4da7f2c4",
                            "launch_specification.562947105.vpc_security_group_ids.#": "1",
                            "launch_specification.562947105.vpc_security_group_ids.1426649768": "sg-984652e1",
                            "launch_specification.562947105.weighted_capacity": "",
                            "launch_specification.629024940.ami": "ami-13c8f475",
                            "launch_specification.629024940.associate_public_ip_address": "false",
                            "launch_specification.629024940.availability_zone": "eu-west-1b",
                            "launch_specification.629024940.ebs_block_device.#": "0",
                            "launch_specification.629024940.ebs_optimized": "false",
                            "launch_specification.629024940.ephemeral_block_device.#": "0",
                            "launch_specification.629024940.iam_instance_profile": "privacy-negotiator.ecs-instprofile",
                            "launch_specification.629024940.instance_type": "m4.large",
                            "launch_specification.629024940.key_name": "spotfleet",
                            "launch_specification.629024940.monitoring": "false",
                            "launch_specification.629024940.placement_group": "",
                            "launch_specification.629024940.placement_tenancy": "",
                            "launch_specification.629024940.root_block_device.#": "0",
                            "launch_specification.629024940.spot_price": "0.03",
                            "launch_specification.629024940.subnet_id": "subnet-cc548985",
                            "launch_specification.629024940.user_data": "5303dc2604da2a8f19732006df98143e4da7f2c4",
                            "launch_specification.629024940.vpc_security_group_ids.#": "1",
                            "launch_specification.629024940.vpc_security_group_ids.1426649768": "sg-984652e1",
                            "launch_specification.629024940.weighted_capacity": "",
                            "replace_unhealthy_instances": "false",
                            "spot_price": "1.0",
                            "spot_request_state": "active",
                            "target_capacity": "3",
                            "terminate_instances_with_expiration": "false",
                            "valid_until": "2019-11-04T20:44:20Z"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_subnet.app.0": {
                    "type": "aws_subnet",
                    "depends_on": [
                        "aws_vpc.app",
                        "data.aws_availability_zones.available"
                    ],
                    "primary": {
                        "id": "subnet-d4b96fb3",
                        "attributes": {
                            "assign_ipv6_address_on_creation": "false",
                            "availability_zone": "eu-west-1a",
                            "cidr_block": "10.0.0.0/24",
                            "id": "subnet-d4b96fb3",
                            "map_public_ip_on_launch": "false",
                            "tags.%": "2",
                            "tags.Name": "privacy-negotiator.ecs.0",
                            "tags.cluster": "privacy-negotiator",
                            "vpc_id": "vpc-46ab7b21"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_subnet.app.1": {
                    "type": "aws_subnet",
                    "depends_on": [
                        "aws_vpc.app",
                        "data.aws_availability_zones.available"
                    ],
                    "primary": {
                        "id": "subnet-cc548985",
                        "attributes": {
                            "assign_ipv6_address_on_creation": "false",
                            "availability_zone": "eu-west-1b",
                            "cidr_block": "10.0.1.0/24",
                            "id": "subnet-cc548985",
                            "map_public_ip_on_launch": "false",
                            "tags.%": "2",
                            "tags.Name": "privacy-negotiator.ecs.1",
                            "tags.cluster": "privacy-negotiator",
                            "vpc_id": "vpc-46ab7b21"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_subnet.app.2": {
                    "type": "aws_subnet",
                    "depends_on": [
                        "aws_vpc.app",
                        "data.aws_availability_zones.available"
                    ],
                    "primary": {
                        "id": "subnet-cf3c2e97",
                        "attributes": {
                            "assign_ipv6_address_on_creation": "false",
                            "availability_zone": "eu-west-1c",
                            "cidr_block": "10.0.2.0/24",
                            "id": "subnet-cf3c2e97",
                            "map_public_ip_on_launch": "false",
                            "tags.%": "2",
                            "tags.Name": "privacy-negotiator.ecs.2",
                            "tags.cluster": "privacy-negotiator",
                            "vpc_id": "vpc-46ab7b21"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "aws_vpc.app": {
                    "type": "aws_vpc",
                    "depends_on": [],
                    "primary": {
                        "id": "vpc-46ab7b21",
                        "attributes": {
                            "assign_generated_ipv6_cidr_block": "false",
                            "cidr_block": "10.0.0.0/16",
                            "default_network_acl_id": "acl-3fa9cd58",
                            "default_route_table_id": "rtb-edd7fa8a",
                            "default_security_group_id": "sg-994753e0",
                            "dhcp_options_id": "dopt-18e4e77d",
                            "enable_classiclink": "false",
                            "enable_dns_hostnames": "true",
                            "enable_dns_support": "true",
                            "id": "vpc-46ab7b21",
                            "instance_tenancy": "default",
                            "main_route_table_id": "rtb-edd7fa8a",
                            "tags.%": "2",
                            "tags.Name": "privacy-negotiator.ecs",
                            "tags.cluster": "privacy-negotiator"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.aws_availability_zones.available": {
                    "type": "aws_availability_zones",
                    "depends_on": [],
                    "primary": {
                        "id": "2017-06-07 20:37:07.711161806 +0000 UTC",
                        "attributes": {
                            "id": "2017-06-07 20:37:07.711161806 +0000 UTC",
                            "names.#": "3",
                            "names.0": "eu-west-1a",
                            "names.1": "eu-west-1b",
                            "names.2": "eu-west-1c"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.template_file.user_data": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_ecs_cluster.app"
                    ],
                    "primary": {
                        "id": "6349a26430b568ec062da9d2c645edec0fd3fa3334535857f92f2de646949dfb",
                        "attributes": {
                            "id": "6349a26430b568ec062da9d2c645edec0fd3fa3334535857f92f2de646949dfb",
                            "rendered": "#!/bin/bash\n\necho \"\"\necho \"Joining ECS Cluster: privacy-negotiator!\"\necho \"\"\necho ECS_CLUSTER=privacy-negotiator \u003e\u003e /etc/ecs/ecs.config\n\necho \"\"\necho \"Upgrading ECS\"\necho \"\"\nsudo yum update -y ecs-init\nsudo service docker restart\nsudo start ecs\n\n# echo \"\"\n# echo \"Upgrading Weave Scope\"\n# echo \"\"\n# sudo curl -L git.io/scope -o /usr/local/bin/scope\n# sudo chmod a+x /usr/local/bin/scope\n# sudo stop scope\n# sudo start scope\n\necho \"\"\necho \"Disabling Weave Scope\"\necho \"\"\nrm /etc/init/scope.conf\n\necho \"\"\necho \"Upgrading Weave Net\"\necho \"\"\nsudo curl -L git.io/weave -o /usr/local/bin/weave\nsudo chmod a+x /usr/local/bin/weave\nsudo stop weave\nsudo start weave\n",
                            "template": "#!/bin/bash\n\necho \"\"\necho \"Joining ECS Cluster: ${ecs_cluster_name}!\"\necho \"\"\necho ECS_CLUSTER=${ecs_cluster_name} \u003e\u003e /etc/ecs/ecs.config\n\necho \"\"\necho \"Upgrading ECS\"\necho \"\"\nsudo yum update -y ecs-init\nsudo service docker restart\nsudo start ecs\n\n# echo \"\"\n# echo \"Upgrading Weave Scope\"\n# echo \"\"\n# sudo curl -L git.io/scope -o /usr/local/bin/scope\n# sudo chmod a+x /usr/local/bin/scope\n# sudo stop scope\n# sudo start scope\n\necho \"\"\necho \"Disabling Weave Scope\"\necho \"\"\nrm /etc/init/scope.conf\n\necho \"\"\necho \"Upgrading Weave Net\"\necho \"\"\nsudo curl -L git.io/weave -o /usr/local/bin/weave\nsudo chmod a+x /usr/local/bin/weave\nsudo stop weave\nsudo start weave\n",
                            "vars.%": "4",
                            "vars.aws_region": "eu-west-1",
                            "vars.ecs_agent_version": "latest",
                            "vars.ecs_cluster_name": "privacy-negotiator",
                            "vars.ecs_log_level": "info"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        }
    ]
}
